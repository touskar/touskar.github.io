(function(){var e={3249:function(e,t,a){"use strict";var n=a(3862),i=a(3396),r=a(7139);const s={id:"nav"},o={style:{float:"left","margin-left":"26px"}},l=(0,i._)("span",{style:{display:"inline-block",width:"5px"}},null,-1),c={id:"app"};function u(e,t,a,n,u,d){const h=(0,i.up)("va-button"),p=(0,i.up)("router-view");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",s,[(0,i._)("span",o,(0,r.zw)(u.apiKey?.name),1),(0,i.Wm)(h,{color:"primary",onClick:t[0]||(t[0]=e=>d.goto("/")),style:{width:"140px"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)("Rechercher".toUpperCase()),1)])),_:1}),l,(0,i.Wm)(h,{color:"primary",onClick:t[1]||(t[1]=e=>d.goto("/train")),style:{width:"140px"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)("Entraîner".toUpperCase()),1)])),_:1})]),(0,i._)("div",c,[(0,i.Wm)(p)])],64)}const d=[{name:"Evolus Group",value:"xQXYN3NX8WbVRSOXek5HYZTuu3l72h0Z"},{name:"Moussa Ndour",value:"ek5HYZTuu3l72h0ZxQXYN3NX8WbVRSOX"}];function h(){const e=p("apiKey");return d.find((t=>t.value===e))}function p(e,t=window.location.href){e=e.replace(/[\\[\]]/g,"\\$&");const a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=a.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var f=a(7387),m=a.n(f),g={name:"App",async mounted(){const e=h();e||(this.$vaToast.init({message:"APiKey Incorrect ou manquant",color:"danger",duration:7e7}),m()(".app").remove())},data(){return{apiKey:h()}},methods:{goto(e){this.$router.push(e)}}},v=a(89);const w=(0,v.Z)(g,[["render",u]]);var y=w,x=a(678),b=a.p+"img/logo.10dda793.png";const _=(0,i._)("img",{style:{width:"100px"},src:b},null,-1);function k(e,t,a,n,r,s){const o=(0,i.up)("SearchAttachmentComponent");return(0,i.wg)(),(0,i.iD)(i.HY,null,[_,(0,i.Wm)(o)],64)}const C=e=>((0,i.dD)("data-v-5ae4a997"),e=e(),(0,i.Cn)(),e),O={class:"container"},F=C((()=>(0,i._)("div",{class:"hello"},"BioMetrex",-1))),j={style:{margin:"10px",_background:"#f9f9f9"},class:"dropzone-container"},P={key:0,style:{margin:"50px"}},S={class:"components"},T=C((()=>(0,i._)("div",{style:{height:"25px"}},null,-1))),U={class:"component",style:{}},W=C((()=>(0,i._)("div",{style:{height:"25px"}},null,-1))),M={class:"component",style:{}},B=C((()=>(0,i._)("div",{style:{height:"25px"}},null,-1))),D={class:"component",style:{}},V=C((()=>(0,i._)("div",{style:{height:"25px"}},null,-1))),z={key:1,style:{margin:"50px"}},A={class:"components"},q={key:2,style:{margin:"50px"}},R=["src"],I={accept:"image/png, image/jpeg",style:{display:"none"},ref:"input",type:"file"},N={class:"file-selector"},$=["src"],G={key:1,width:"104px",height:"104px",viewBox:"0 0 104 104",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},L=(0,i.uE)('<defs data-v-5ae4a997><circle id="path-1" cx="36" cy="36" r="36" data-v-5ae4a997></circle><filter x="-37.5%" y="-29.2%" width="175.0%" height="175.0%" filterUnits="objectBoundingBox" id="filter-2" data-v-5ae4a997><feOffset dx="0" dy="6" in="SourceAlpha" result="shadowOffsetOuter1" data-v-5ae4a997></feOffset><feGaussianBlur stdDeviation="8" in="shadowOffsetOuter1" result="shadowBlurOuter1" data-v-5ae4a997></feGaussianBlur><feColorMatrix values="0 0 0 0 0.0117647059   0 0 0 0 0.0862745098   0 0 0 0 0.160784314  0 0 0 0.08 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1" data-v-5ae4a997></feColorMatrix><feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter2" data-v-5ae4a997></feOffset><feGaussianBlur stdDeviation="1" in="shadowOffsetOuter2" result="shadowBlurOuter2" data-v-5ae4a997></feGaussianBlur><feColorMatrix values="0 0 0 0 0.0117647059   0 0 0 0 0.0862745098   0 0 0 0 0.160784314  0 0 0 0.11 0" type="matrix" in="shadowBlurOuter2" result="shadowMatrixOuter2" data-v-5ae4a997></feColorMatrix><feMerge data-v-5ae4a997><feMergeNode in="shadowMatrixOuter1" data-v-5ae4a997></feMergeNode><feMergeNode in="shadowMatrixOuter2" data-v-5ae4a997></feMergeNode></feMerge></filter></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" data-v-5ae4a997><g id="Artboard" transform="translate(-460.000000, -125.000000)" data-v-5ae4a997><g id="Group-4" transform="translate(412.000000, 129.000000)" data-v-5ae4a997><g id="Group-2" transform="translate(58.000000, 0.000000)" data-v-5ae4a997><circle id="Oval" fill="#3560FF" opacity="0.100000001" cx="42" cy="42" r="42" data-v-5ae4a997></circle><g id="Group" transform="translate(6.000000, 6.000000)" data-v-5ae4a997><g id="Oval" data-v-5ae4a997><use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1" data-v-5ae4a997></use><use fill="#FFFFFF" fill-rule="evenodd" xlink:href="#path-1" data-v-5ae4a997></use></g><g id="upload-cloud" transform="translate(21.818182, 24.000000)" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" data-v-5ae4a997><polyline id="Path" stroke="#000000" points="19.6458087 17.3789847 14.3565525 12.0897285 9.06729634 17.3789847" data-v-5ae4a997></polyline><path d="M14.3565525,12.0897285 L14.3565525,24.1794569" id="Path" stroke="#3560FF" data-v-5ae4a997></path><path d="M25.6438239,20.7792208 C28.2965835,19.3021499 29.6312816,16.1761528 28.8860265,13.1856562 C28.1407715,10.1951596 25.5052337,8.10125672 22.4838689,8.09921935 L20.8179512,8.09921935 C19.7219904,3.76967373 16.1275086,0.577339516 11.7773112,0.0700384831 C7.42711383,-0.43726255 3.22057026,1.84535014 1.19724759,5.81113853 C-0.826075091,9.77692693 -0.247870665,14.6059952 2.6515151,17.9569414" id="Path" stroke="#3560FF" data-v-5ae4a997></path><polyline id="Path" stroke="#3560FF" points="19.6458087 17.3789847 14.3565525 12.0897285 9.06729634 17.3789847" data-v-5ae4a997></polyline></g></g></g></g></g></g>',2),E=[L],Z=(0,i.Uk)(" Ajouter une image pour démarer la recherche "),Y=C((()=>(0,i._)("p",{class:"separator",style:{"margin-top":"10px","margin-bottom":"10px"}},[(0,i._)("span",{style:{visibility:"hidden"}},".")],-1))),H=(0,i.Uk)((0,r.zw)("Choisir")),X=C((()=>(0,i._)("span",{style:{display:"inline-block",width:"5px"}},null,-1))),K=(0,i.Uk)((0,r.zw)("Arreter"));function J(e,t,a,n,s,o){const l=(0,i.up)("va-alert"),c=(0,i.up)("va-input"),u=(0,i.up)("va-progress-bar"),d=(0,i.up)("va-list-label"),h=(0,i.up)("va-avatar"),p=(0,i.up)("va-list-item-section"),f=(0,i.up)("va-list-item-label"),m=(0,i.up)("va-icon"),g=(0,i.up)("va-list-item"),v=(0,i.up)("va-list"),w=(0,i.up)("va-button");return(0,i.wg)(),(0,i.iD)("div",O,[F,(0,i._)("div",null,[(0,i._)("div",j,[s.searching?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",P,[(0,i._)("div",S,[(0,i._)("div",null,[(0,i.Wm)(l,{border:"top",class:"mb-4"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Recherche dans la base "+(0,r.zw)(s.subjectCount)+" sujets déja enregistré ",1)])),_:1})]),T,(0,i._)("div",U,[(0,i.Wm)(c,{min:1,max:200,type:"number",modelValue:s.concurrency,"onUpdate:modelValue":t[0]||(t[0]=e=>s.concurrency=e),label:"Nombre de tache en simultané (1-200)"},null,8,["modelValue"])]),W,(0,i._)("div",M,[(0,i.Wm)(c,{min:10,max:100,type:"number",modelValue:s.threshold,"onUpdate:modelValue":t[1]||(t[1]=e=>s.threshold=e),label:"Score minimum à matcher (10-100)"},null,8,["modelValue"])]),B,(0,i._)("div",D,[(0,i.Wm)(c,{min:1,max:100,type:"number",modelValue:s.maxResult,"onUpdate:modelValue":t[2]||(t[2]=e=>s.maxResult=e),label:"Nombre maximum de sujet à matcher  (1-100)"},null,8,["modelValue"])]),V])])),s.searching?((0,i.wg)(),(0,i.iD)("div",z,[(0,i._)("div",A,[(0,i.Wm)(u,{size:"medium",buffer:100,"model-value":o.searchPercent()},null,8,["model-value"])])])):(0,i.kq)("",!0),s.matches.length?((0,i.wg)(),(0,i.iD)("div",q,[(0,i.Wm)(v,{fit:""},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{style:{"text-align":"left","font-size":"25px"}},{default:(0,i.w5)((()=>[(0,i.Uk)(" Concordances ("+(0,r.zw)(s.matches.length)+") ",1)])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.matches,((e,t)=>((0,i.wg)(),(0,i.j4)(g,{key:t},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i._)("img",{src:o.getSubjectPhoto(e)},null,8,R)])),_:2},1024)])),_:2},1024),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(f,{style:{"text-align":"left"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.key.toUpperCase()),1)])),_:2},1024),(0,i.Wm)(f,{caption:"",style:{"font-weight":"bold","text-align":"left"}},{default:(0,i.w5)((()=>[(0,i.Uk)(" score: "+(0,r.zw)(e.score.toFixed(2)),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(p,{icon:""},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:t=>o.openImage(o.getSubjectPhoto(e)),name:"remove_red_eye",color:"gray"},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])):(0,i.kq)("",!0),(0,i._)("input",I,null,512),(0,i._)("div",{onClick:t[4]||(t[4]=(...e)=>o.selectFolder&&o.selectFolder(...e))},[(0,i._)("div",N,[(0,i._)("figure",null,[s.searching?((0,i.wg)(),(0,i.iD)("img",{key:0,style:{"border-radius":"80px",border:"4px solid #e2e7f7",margin:"20px",width:"120px",height:"120px"},src:s.searchBlobUrl},null,8,$)):(0,i.kq)("",!0),s.searching?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("svg",G,E))]),Z,Y,(0,i.Wm)(w,{disabled:s.searching,color:"primary",style:{width:"140px"}},{default:(0,i.w5)((()=>[H])),_:1},8,["disabled"]),X,(0,i.Wm)(w,{onClick:t[3]||(t[3]=e=>o.stopSearch()),disabled:!s.searching,color:"primary",style:{width:"140px"}},{default:(0,i.w5)((()=>[K])),_:1},8,["disabled"])])])])])])}var Q=a(166),ee=a(7603);const te=new ee.ZP("biometrex");async function ae(){return await te.subjects.count()}async function ne(){await te.subjects.clear(),console.log("delete existing")}async function ie(){return te.table("subjects").toArray()}async function re(e,t){const a=await te.subjects.where("key").equals(e).first();a?(console.log("save face for subject",t),await te.subjects.update(a.id,{faceDescription:a.faceDescription.concat(t)})):console.warn("try to set face data to unexisted record")}async function se(e,t,a){console.log("init for ",e,a);const n=await te.subjects.where("key").equals(e).first(),i=t.map((e=>new Blob([e],{type:e.type})));n&&"override"!==a?(console.log("exist, strategy",a,n),await te.subjects.update(n.id,{personFiles:n.personFiles.concat(i)})):(n&&(console.log("exist, strategy",a,n),await te.subjects.where("key").equals(e).delete(),console.log("delete existing")),console.log("no exist, strategy"),await te.subjects.add({key:e,personFiles:i,faceDescription:[]}),console.log("added"))}te.version(1).stores({subjects:"++id, key"});const oe=a(3233),le="/models";var ce={name:"SearchAttachmentComponent",data(){return{$directory:"",eventInit:!1,searching:!1,searchBlobUrl:null,concurrency:1,searchProgress:0,willTrainCount:0,threshold:80,maxResult:10,subjectCount:"",matches:[],queue:null}},components:{},setup(){return{}},mounted(){this.iniFaceJs(),this.countSubject()},methods:{async stopSearch(){console.log("here"),this.queue?.stop(),await this.sleep(100),this.reset()},searchPercent(){return 100*this.searchProgress/this.willTrainCount},async reset(){this.searching=!1,this.matches=[],this.queue=null,this.searchProgress=0,this.willTrainCount=0,this.countSubject()},openImage(e){window.open(e,"_blank","toolbar=1, scrollbars=1, resizable=1, width=1015, height=800")},async sleep(e){return new Promise((t=>setTimeout(t,e)))},async countSubject(){this.subjectCount=await ae()},async iniFaceJs(){await Q.dd(le),await Q.W6(le),await Q.Qk(le)},selectFolder(){if(this.searching)return;const e=m()(this.$refs.input);this.eventInit||(this.listenChangeEvent(e),this.eventInit=!0),e.click()},listenChangeEvent(e){e.on("change",(()=>{const t=e[0].files[0];console.log(t),this.willTrainCount=this.subjectCount,console.log(this.willTrainCount,"willTrainCount"),this.searchFace(t)}))},finishSearch(){this.$vaToast.init("Recherche terminé"),this.queue?.stop(),console.log(this.matches)},getSubjectPhoto(e){try{return URL.createObjectURL(e.personFiles[0])}catch(t){console.log()}},async matchPerson(e,t,a){try{for(let a of e.faceDescription){let n=Q.WI(a.descriptor,t.descriptor);const i=100*(1-n);if(i>=this.threshold){e.score=i,this.matches.push(e);break}}}catch(n){console.log(n)}this.searchProgress++,a(),this.matches.length>=this.maxResult&&this.finishSearch()},async searchFace(e){this.queue=new oe({autoStart:!0,concurrency:this.concurrency}),this.searchBlobUrl=URL.createObjectURL(new Blob([e],{type:e.type})),this.searching=!0,this.$vaToast.init("Recherche sur le point de démarrer"),console.log("start searching");const t=await Q.dV(e),a=await Q.bd(t).withFaceLandmarks().withFaceDescriptor(),n=[],i=await ie();for(let r of i)n.push(this.queue.pushTask((e=>{this.matchPerson(r,a,e)})));await Promise.all(n),this.finishSearch()}},computed:{}};const ue=(0,v.Z)(ce,[["render",J],["__scopeId","data-v-5ae4a997"]]);var de=ue,he={name:"SearchPage",components:{SearchAttachmentComponent:de}};const pe=(0,v.Z)(he,[["render",k]]);var fe=pe;const me=(0,i._)("img",{style:{width:"100px"},src:b},null,-1);function ge(e,t,a,n,r,s){const o=(0,i.up)("TrainAttachmentComponent");return(0,i.wg)(),(0,i.iD)(i.HY,null,[me,(0,i.Wm)(o)],64)}const ve=e=>((0,i.dD)("data-v-1cb82370"),e=e(),(0,i.Cn)(),e),we={class:"container"},ye=ve((()=>(0,i._)("div",{class:"hello"},"BioMetrex",-1))),xe={style:{margin:"10px",_background:"#f9f9f9"},class:"dropzone-container"},be={key:0,style:{margin:"50px"}},_e={class:"components"},ke=ve((()=>(0,i._)("div",{style:{height:"25px"}},null,-1))),Ce={class:"component",style:{}},Oe=ve((()=>(0,i._)("div",{style:{height:"25px"}},null,-1))),Fe={class:"component",style:{}},je=ve((()=>(0,i._)("div",{style:{height:"25px"}},null,-1))),Pe={class:"component",style:{}},Se={key:1,style:{margin:"50px"}},Te={class:"components"},Ue={style:{display:"none"},ref:"input",multiple:"",directory:"",webkitdirectory:"",moxdirectory:"",type:"file"},We={class:"file-selector"},Me=ve((()=>(0,i._)("figure",null,[(0,i._)("svg",{width:"104px",height:"104px",viewBox:"0 0 104 104",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},[(0,i._)("defs",null,[(0,i._)("circle",{id:"path-1",cx:"36",cy:"36",r:"36"}),(0,i._)("filter",{x:"-37.5%",y:"-29.2%",width:"175.0%",height:"175.0%",filterUnits:"objectBoundingBox",id:"filter-2"},[(0,i._)("feOffset",{dx:"0",dy:"6",in:"SourceAlpha",result:"shadowOffsetOuter1"}),(0,i._)("feGaussianBlur",{stdDeviation:"8",in:"shadowOffsetOuter1",result:"shadowBlurOuter1"}),(0,i._)("feColorMatrix",{values:"0 0 0 0 0.0117647059   0 0 0 0 0.0862745098   0 0 0 0 0.160784314  0 0 0 0.08 0",type:"matrix",in:"shadowBlurOuter1",result:"shadowMatrixOuter1"}),(0,i._)("feOffset",{dx:"0",dy:"1",in:"SourceAlpha",result:"shadowOffsetOuter2"}),(0,i._)("feGaussianBlur",{stdDeviation:"1",in:"shadowOffsetOuter2",result:"shadowBlurOuter2"}),(0,i._)("feColorMatrix",{values:"0 0 0 0 0.0117647059   0 0 0 0 0.0862745098   0 0 0 0 0.160784314  0 0 0 0.11 0",type:"matrix",in:"shadowBlurOuter2",result:"shadowMatrixOuter2"}),(0,i._)("feMerge",null,[(0,i._)("feMergeNode",{in:"shadowMatrixOuter1"}),(0,i._)("feMergeNode",{in:"shadowMatrixOuter2"})])])]),(0,i._)("g",{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[(0,i._)("g",{id:"Artboard",transform:"translate(-460.000000, -125.000000)"},[(0,i._)("g",{id:"Group-4",transform:"translate(412.000000, 129.000000)"},[(0,i._)("g",{id:"Group-2",transform:"translate(58.000000, 0.000000)"},[(0,i._)("circle",{id:"Oval",fill:"#3560FF",opacity:"0.100000001",cx:"42",cy:"42",r:"42"}),(0,i._)("g",{id:"Group",transform:"translate(6.000000, 6.000000)"},[(0,i._)("g",{id:"Oval"},[(0,i._)("use",{fill:"black","fill-opacity":"1",filter:"url(#filter-2)","xlink:href":"#path-1"}),(0,i._)("use",{fill:"#FFFFFF","fill-rule":"evenodd","xlink:href":"#path-1"})]),(0,i._)("g",{id:"upload-cloud",transform:"translate(21.818182, 24.000000)","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[(0,i._)("polyline",{id:"Path",stroke:"#000000",points:"19.6458087 17.3789847 14.3565525 12.0897285 9.06729634 17.3789847"}),(0,i._)("path",{d:"M14.3565525,12.0897285 L14.3565525,24.1794569",id:"Path",stroke:"#3560FF"}),(0,i._)("path",{d:"M25.6438239,20.7792208 C28.2965835,19.3021499 29.6312816,16.1761528 28.8860265,13.1856562 C28.1407715,10.1951596 25.5052337,8.10125672 22.4838689,8.09921935 L20.8179512,8.09921935 C19.7219904,3.76967373 16.1275086,0.577339516 11.7773112,0.0700384831 C7.42711383,-0.43726255 3.22057026,1.84535014 1.19724759,5.81113853 C-0.826075091,9.77692693 -0.247870665,14.6059952 2.6515151,17.9569414",id:"Path",stroke:"#3560FF"}),(0,i._)("polyline",{id:"Path",stroke:"#3560FF",points:"19.6458087 17.3789847 14.3565525 12.0897285 9.06729634 17.3789847"})])])])])])])])],-1))),Be=(0,i.Uk)(" Ajouter un dossier pour entrainer les modèles "),De=ve((()=>(0,i._)("p",{class:"separator",style:{"margin-top":"10px","margin-bottom":"10px"}},[(0,i._)("span",{style:{visibility:"hidden"}},".")],-1))),Ve=(0,i.Uk)((0,r.zw)("Choisir"));function ze(e,t,a,n,s,o){const l=(0,i.up)("va-alert"),c=(0,i.up)("va-input"),u=(0,i.up)("va-select"),d=(0,i.up)("va-progress-bar"),h=(0,i.up)("va-button");return(0,i.wg)(),(0,i.iD)("div",we,[ye,(0,i._)("div",null,[(0,i._)("div",xe,[s.traning?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",be,[(0,i._)("div",_e,[(0,i._)("div",null,[(0,i.Wm)(l,{border:"top",class:"mb-4"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(s.subjectCount)+" Sujets déja enregistré ",1)])),_:1})]),ke,(0,i._)("div",Ce,[(0,i.Wm)(c,{min:1,max:200,type:"number",modelValue:s.concurrency,"onUpdate:modelValue":t[0]||(t[0]=e=>s.concurrency=e),label:"Nombre de tache en simultané (1-200)"},null,8,["modelValue"])]),Oe,(0,i._)("div",Fe,[(0,i.Wm)(c,{min:1,max:200,type:"number",modelValue:s.idSize,"onUpdate:modelValue":t[1]||(t[1]=e=>s.idSize=e),label:"Longueur des identifiants (1-200)"},null,8,["modelValue"])]),je,(0,i._)("div",Pe,[(0,i.Wm)(u,{modelValue:s.strategySelectValue,"onUpdate:modelValue":t[2]||(t[2]=e=>s.strategySelectValue=e),options:s.strategyOptions,label:"Stratégie des données existantes"},null,8,["modelValue","options"])])])])),s.traning?((0,i.wg)(),(0,i.iD)("div",Se,[(0,i._)("div",Te,[(0,i.Wm)(d,{size:"medium",buffer:100,"model-value":o.trainPercent()},null,8,["model-value"])])])):(0,i.kq)("",!0),(0,i._)("input",Ue,null,512),(0,i._)("div",{onClick:t[3]||(t[3]=(...e)=>o.selectFolder&&o.selectFolder(...e))},[(0,i._)("div",We,[Me,Be,De,(0,i.Wm)(h,{disabled:s.traning,color:"primary",style:{width:"140px"}},{default:(0,i.w5)((()=>[Ve])),_:1},8,["disabled"])])])])])])}const Ae=a(3233),qe="/models";var Re={name:"TrainAttachmentComponent",data(){return{$directory:"",eventInit:!1,traning:!1,concurrency:1,trainProgress:0,willTrainCount:0,idSize:36,subjectCount:"",strategySelectValue:{text:"Écraser",value:"override"},strategyOptions:[{text:"Écraser",value:"override"},{text:"Fusionner",value:"merge"}]}},components:{},setup(){return{}},mounted(){this.iniFaceJs(),this.countSubject()},methods:{trainPercent(){return 100*this.trainProgress/this.willTrainCount},async reset(){this.traning=!1,this.trainProgress=0,this.willTrainCount=0,this.countSubject()},async sleep(e){return new Promise((t=>setTimeout(t,e)))},async countSubject(){this.subjectCount=await ae()},async iniFaceJs(){await Q.dd(qe),await Q.W6(qe),await Q.Qk(qe)},selectFolder(){if(this.traning)return this.$vaToast.init("Une tache est deja en cours");const e=m()(this.$refs.input);this.eventInit||(this.listenChangeEvent(e),this.eventInit=!0),e.click()},groupFilePerId(e){const t={};for(let a of e){const e=a.name.substring(0,this.idSize);t[e]=t[e]||[],t[e].push(a)}return t},listenChangeEvent(e){e.on("change",(()=>{const t=e[0].files;this.willTrainCount=t.length,console.log(this.willTrainCount,"willTrainCount");const a=this.groupFilePerId(t);this.trainData(a)}))},async trainSingleFace(e,t,a){try{const n=await Q.dV(t),i=await Q.bd(n).withFaceLandmarks().withFaceDescriptor();if(!i)return console.log(`no faces detected for in image ${t.name}`),this.trainProgress++,void a();const r=i;return console.log(this.trainProgress,this.willTrainCount),re(e,r),this.trainProgress++,a(),r}catch(n){console.log(n),a()}},async trainData(e){"override"===this.strategySelectValue.value&&await ne();const t=new Ae({autoStart:!0,concurrency:this.concurrency});this.traning=!0,console.log("start training"),this.$vaToast.init("Entrainement sur le point de démarrer");const a=[];for(let i of Object.keys(e))a.push(t.pushTask((async t=>{try{const n=e[i];await se(i,n,this.strategySelectValue.value);for(let e of n)a.push(this.trainSingleFace(i,e,t))}catch(n){console.log(n),t()}})));const n=(await Promise.all(a)).filter((e=>e));this.traning=!1,t.stop(),this.reset(),console.log(n,"resultsTrain"),this.$vaToast.init("Tache terminée")}},computed:{}};const Ie=(0,v.Z)(Re,[["render",ze],["__scopeId","data-v-1cb82370"]]);var Ne=Ie,$e={name:"TrainPage",components:{TrainAttachmentComponent:Ne}};const Ge=(0,v.Z)($e,[["render",ge]]);var Le=Ge;const Ee=[{path:"/",name:"SearchPage",component:fe},{path:"/train",name:"TrainPage",component:Le}],Ze=(0,x.p7)({history:(0,x.PO)(),routes:Ee});var Ye=Ze,He=a(4954);a(2095);(0,n.ri)(y).use(Ye).use((0,He.C)()).mount("#app")},4902:function(){},522:function(){},753:function(){}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,n,i,r){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],i=e[u][1],r=e[u][2];for(var o=!0,l=0;l<n.length;l++)(!1&r||s>=r)&&Object.keys(a.O).every((function(e){return a.O[e](n[l])}))?n.splice(l--,1):(o=!1,r<s&&(s=r));if(o){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[n,i,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.p="/"}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,r,s=n[0],o=n[1],l=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(l)var u=l(a)}for(t&&t(n);c<s.length;c++)r=s[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(u)},n=self["webpackChunkbiometrex"]=self["webpackChunkbiometrex"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(3249)}));n=a.O(n)})();
//# sourceMappingURL=app.14ba4abc.js.map